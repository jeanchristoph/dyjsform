export default class JsonService{constructor(){this._json=[];this._outputJson=[]}get json(){return JSON.parse(JSON.stringify(this._json))}getJsonData(){return JSON.parse(JSON.stringify(this._json.map((row=>row.filter((field=>!field.name.startsWith("dyjsform_action_")))))))}set json(json){switch(typeof json){case"string":this._json=this.strToJson(json);break;default:this._json=json;break}this.outputJson=this.getJsonData()}addRow(entity){const updatedJson=this.json;updatedJson.push(entity);this.json=updatedJson;return this}removeRow(rowNumber){const updatedJson=this.json;updatedJson.splice(rowNumber,1);this.json=updatedJson;return this}get outputJson(){return this._outputJson}set outputJson(json){this._outputJson=this.reduceByNameValue(json)}isJsonString(str){try{JSON.parse(str)}catch(e){console.error(e);return false}return true}jsonToStr(jsonObject){return JSON.stringify(jsonObject,null,2)}strToJson(str){try{return JSON.parse(str)}catch(error){console.error("Erreur lors du parsing JSON :",error);return null}}reduceByNameValue(json){var ReducedJson=[];for(const row of json){let rowJson=[];for(let field of row){rowJson.push({[field["name"]]:field["value"]})}ReducedJson.push(rowJson)}return ReducedJson}populateJson(json){while(this._json.length<json.length){const templateRow=this._json[this._json.length-1].map((field=>({...field,value:""})));this._json.push(templateRow)}this._json=this._json.map(((row,rowIndex)=>{if(json[rowIndex]){return row.map((field=>{const correspondingField=json[rowIndex].find((f=>f.name===field.name));return correspondingField?{...field,value:correspondingField.value}:field}))}return row}))}loadJson(){let entitiesArray=[];let entityArray=[];if(document.querySelector("#dyjsform_options")){const jsonString=document.querySelector("#dyjsform_options").value;if(jsonString){try{const jsonString=document.querySelector("#dyjsform_options").value}catch(error){console.error("Erreur lors de l'analyse du JSON : ",error)}}}return entityArray}updateJsonByField(rowNumber,fieldName,value){let json=this.json;json[rowNumber].forEach(((element,index)=>{if(element.name===fieldName){element.value=value}}));this.json=json}}