import JsonService from"./Service/JsonService.js";import TemplateService from"./Service/TemplateService.js";export default class DyJsForm{constructor(){this._entity=[{html_element:"input",type:"number",name:"name_1",label:"name_1",value:"",content:"",class:""},{html_element:"input",type:"text",label:"name_1",name:"name_2",value:"",content:"",class:""},{html_element:"input",type:"password",label:"name_1",name:"name_3",value:"",content:"",class:""}];this._jsonService=new JsonService;this._templateService=new TemplateService}get entity(){return this._entity}set entity(array){this._entity=array;return this}get template(){return this._templateService.templateName}set template(templateName){this._templateService.templateName=templateName.charAt(0).toUpperCase()+templateName.slice(1);return this}init(){console.log("initializing Dyjsform");this._templateService.loadTemplate().then((()=>{const form=this._templateService.formRender(this._jsonService.json);document.querySelector("#dyjsform").innerHTML=form;this.initHandlers()}));return this}refreshForm(){console.log("refreshing Dyjsform");const form=this._templateService.formRender(this._jsonService.json);document.querySelector("#dyjsform").innerHTML=form;const row=this._templateService.rowRender(this._entity,this._jsonService.json);document.querySelector("#dyjsform_container").innerHTML=row;this.writeOutputJson();this.initHandlers();return this}initHandlers(){this.initEventListeners();this.handleInputKeyup()}initEventListeners(){if(document.getElementById("djf_action_add")){document.getElementById("djf_action_add").addEventListener("click",(event=>{console.log("djf_action_add");event.preventDefault();this._jsonService.addRow(this._entity);this.refreshForm()}))}if(document.getElementById("djf_action_remove")){console.log("document.getElementById(djf_action_remove)");document.getElementById("djf_action_remove").addEventListener("click",(event=>{console.log("djf_action_remove");event.preventDefault();this._jsonService.removeRow();this.refreshForm()}))}return this}async handleInputKeyup(){for(const entity of this._entity){const elements=document.querySelectorAll("."+entity.name);if(elements.length>0){elements.forEach((element=>{element.addEventListener("keyup",(async()=>{await this.refreshForm()}));element.addEventListener("change",(async()=>{await this.refreshForm()}))}))}}return this}writeOutputJson(){console.log("writeOutputJson");console.log(JSON.stringify(this._jsonService.outputJson,null));document.querySelector("#dyjsform_options").value=JSON.stringify(this._jsonService.outputJson,null);return this}}